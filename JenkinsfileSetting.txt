@Library("shared-libraries")
import io.libs.SqlUtils
import io.libs.ProjectHelpers
import io.libs.Utils


import org.xml.sax.InputSource

import javax.xml.xpath.XPath
import javax.xml.xpath.XPathFactory
import java.io.FileReader
import groovy.xml.MarkupBuilder 
import groovy.util.*
def sqlUtils = new SqlUtils()
def utils = new Utils()
def projectHelpers = new ProjectHelpers()

def updateDbTasks = [:]


pipeline {

    parameters {
        string(defaultValue: "${env.jenkinsAgent}", description: 'Нода дженкинса, на которой запускать пайплайн. По умолчанию master', name: 'jenkinsAgent')
        

        
    }

    environment {
        Path_="//nn-fs-01\\Obmen_1c\\CF_UPDATE_TEST_КА\\UpdateSetting.xml"  
    
        
      }

    agent {
        label "${(env.jenkinsAgent == null || env.jenkinsAgent == 'null') ? "master" : env.jenkinsAgent}"
    }
    options {
         timeout(time: 8, unit: 'HOURS') 
         buildDiscarder(logRotator(numToKeepStr:'10'))
     }
    stages {
        
     
        
        stage("Захват объектов в релизном хранилище") {
            steps {
                timestamps {
                    script {
                     //  try {
                     //  (FileReader fileReader = new FileReader("//nn-fs-01/Obmen_1c/CF_UPDATE_TEST_КА/UpdateSetting.XML"))
             
                     //  XPath xPath = XPathFactory.newInstance().newXPath()
                     //  echo xPath
                   // String data = xPath.evaluate("//Result", new InputSource(fileReader))
                     //  echo data
             //  System.out.println(data)
                     //  } catch (Exception e) {
                     //             e.printStackTrace();                  
                                
                                def report = readFile(file: 'UpdateSetting.xml')
		                        def parser = new XmlParser()
                                def doc = parser.parsetext(report)                             
                                def score=doc.movie.year
                                echo "${score}"
                                //double score1 = Double.parseDouble(doc.movie.year[0].value()[0])
                                

                    }
                }
            }
        }


        
    }   
}

